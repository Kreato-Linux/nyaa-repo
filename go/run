#!/bin/sh
NAME="go"
RELEASE="1"
VERSION="1.20.3"
SOURCES="https://go.dev/dl/go$VERSION.src.tar.gz"
SHA256SUM="e447b498cde50215c4f7619e5124b0fc4e25fb5d16ea47271c47f278e7aa763a  go1.20.3.src.tar.gz"
DESCRIPTION="Go is a statically typed, compiled programming language designed at Google"

build() {
    if ! command -v go > /dev/null; then
	    echo "go: go must be installed to build go"
	    echo "go: you can get a binary release at https://go.dev/dl/ or install through kpkg using 'kpkg install go'"
	    exit 1
    fi
    cd src || exit 1
    export GOENV="/tmp/kpkg/srcdir/go/env" 
    export GOCACHE="/tmp/kpkg/srcdir/go-build"
    go env -w  GOCACHE="/tmp/kpkg/srcdir/go-build"
    GOROOT_FINAL=/usr/local/go ./make.bash
}

install() {
    mkdir -p "$ROOT"/bin
    cp -r ./bin "$ROOT"
    mkdir -p "$ROOT"/usr/local/go
    cp -r . "$ROOT"/usr/local/go
    mkdir -p /tmp/nyaa_srcdir/go
    "$ROOT"/bin/go env -w GOROOT=/usr/local/go
}
