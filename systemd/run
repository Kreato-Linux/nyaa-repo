#!/bin/sh
NAME="systemd"
RELEASE="2"
VERSION="254"
SOURCES="https://github.com/systemd/systemd/archive/refs/tags/v$VERSION.tar.gz;ln"
BUILD_DEPENDS="meson samurai"
DEPENDS="gperf libcap util-linux python-jinja2 kmod"
REPLACES="elogind eudev libudev"
SHA256SUM="244da7605800a358915e4b45d079b0b89364be35da4bc8d849821e67bac0ce62  v254.tar.gz;986329dbcc913bd3edc2982137c5028ecf94d4a255bbb13b6859bee285df1211  ln"
DESCRIPTION="The systemd System and Service Manager"

prepare() {
    tar -xvf v$VERSION.tar.gz
    cd systemd-$VERSION

    # Force set relative_source_path as realpath on busybox doesn't support
    # arguments used there.
    sed -ie '/relative_source_path = /{n;N;N;d}' meson.build
    sed -i "/^relative_source_path = run_command/c\relative_source_path = '..'" meson.build
}

build() {
    meson --prefix=/usr build/
    ninja -C build/
}

package() {
    export PATH="$PATH:$(realpath ../)"
    DESTDIR=$ROOT ninja -C build/ install
}
